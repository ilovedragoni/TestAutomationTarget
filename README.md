# TestAutomationTarget

A Spring Boot + React application built as a practical target for UI/API test automation.

The app includes:
- Product/catalog browsing
- Authentication (sign up/sign in/session restore/sign out)
- Authenticated cart flows (server-backed)
- Checkout flow with persisted orders
- Profile management (orders, account details, password, addresses, payment methods, notifications, account deletion)

## Stack

- Backend: Java 21, Spring Boot 3.2, Spring Data JPA, Spring Security, Flyway, Spring Batch
- Frontend: React 18, Redux Toolkit, React Router, Vite
- Runtime DB: PostgreSQL
- Test DB: H2 in-memory (`src/test/resources/application-test.yml`)

## Quick Start

### Option A: Backend serves built frontend

```bash
cd frontend && npm install && npm run build && cd ..
mvn spring-boot:run
```

Or package and run:

```bash
mvn package
java -jar target/TestAutomationTarget-1.0-SNAPSHOT.jar
```

- Web UI: http://localhost:8080/
- Health: http://localhost:8080/health
- API status: http://localhost:8080/api/status

### Option B: Frontend dev server + backend

```bash
# Terminal 1
mvn spring-boot:run

# Terminal 2
cd frontend && npm install && npm run dev
```

- React app: http://localhost:3000
- Backend: http://localhost:8080

Vite proxies `/api` and `/health` to backend (see `frontend/vite.config.js`).

## Database

### Runtime (default)

Configured in `src/main/resources/application.yml`:
- URL: `jdbc:postgresql://localhost:5432/targetdb`
- User: `sa`
- Password: `secret`

Start PostgreSQL quickly:

```bash
docker compose up -d
```

Wipe the data completely:

```bash
docker compose down -v
```

### Tests

Tests run with H2 and the `test` profile (`src/test/resources/application-test.yml`).
Flyway is disabled in tests; schema is generated by Hibernate (`ddl-auto=create-drop`).

## Seed Data

On empty DB startup, the app seeds products by default:

```yaml
seed:
  enabled: true
  count: 1000
```

Disabled in `test` profile.

## Frontend Routes

- `/` Home (test automation information)
- `/products` Product catalog
- `/cart` Shopping cart
- `/checkout` Checkout form
- `/checkout/success` One-time order confirmation screen
- `/signin` Sign in
- `/signup` Sign up
- `/profile` Signed-in profile page (Orders, Account, Addresses, Payment Methods, Notifications)
- `/contact` Contact page

## Current API Surface

### Public

- `GET /health`
- `GET /api/status`
- `GET /api/products`
- `GET /api/products/{id}`
- `GET /api/categories`
- `GET /api/categories/{id}`
- `POST /api/auth/signup`
- `POST /api/auth/signin`
- `GET /api/auth/me` (returns `401` when no valid session)
- `POST /api/auth/logout`

### Authenticated

Cart:
- `GET /api/cart`
- `PUT /api/cart` (replace cart)
- `DELETE /api/cart` (clear cart)

Checkout:
- `POST /api/checkout` (creates order + order items, clears cart)

Orders:
- `GET /api/orders` (current user order history)

Profile:
- `PATCH /api/profile/account` (update display name/email)
- `PATCH /api/profile/account/password` (change password)
- `DELETE /api/profile/account` (delete current user account)
- `GET /api/profile/addresses`
- `POST /api/profile/addresses`
- `DELETE /api/profile/addresses/{addressId}`
- `PATCH /api/profile/addresses/{addressId}/default`
- `GET /api/profile/payment-methods`
- `POST /api/profile/payment-methods`
- `DELETE /api/profile/payment-methods/{paymentMethodId}`
- `PATCH /api/profile/payment-methods/{paymentMethodId}/default`

## Cart Behavior

The cart is server-backed and requires authentication:

1. Users must be signed in to add/update/remove cart items.
2. Cart changes are synced to backend via `PUT /api/cart`.
3. Checkout (`POST /api/checkout`) validates cart/subtotal, creates an order, and clears the cart.
4. Users can review order history from Profile (Orders), powered by `GET /api/orders`.
5. Users can manage saved addresses/payment methods and account details from Profile.

## Checkout UX Notes

- Successful checkout redirects to `/checkout/success`.
- The confirmation screen is intended as a one-time post-checkout view and relies on navigation state from the checkout flow.

## Testing Notes

The UI keeps stable selectors (`id` and `data-testid`) for automation.

Examples:
- Product card row: ``data-testid="product-row-{id}"``
- Add-to-cart button: ``id="buy-{id}"``
- Cart count badge: ``id="cart-count"``
- Auth forms: ``id="signin-form"``, ``id="signup-form"``

## Run Tests

Run all backend tests:

```bash
mvn "-Dskip.frontend=true" test
```

Controller slice tests only (`@WebMvcTest`):

```bash
mvn "-Dtest=org.testautomation.controller.*WebMvcTest" "-Dskip.frontend=true" test
```

Integration flows only (`@SpringBootTest`):

```bash
mvn "-Dtest=org.testautomation.integration.*IntegrationTest" "-Dskip.frontend=true" test
```
